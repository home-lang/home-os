// home-os Wget
// Download files from the web

import "../../kernel/src/core/foundation.home" as foundation
import "../../kernel/src/net/http.home" as http
import "../../kernel/src/core/filesystem.home" as filesystem

export fn wget_main(url: u64, output: u64) {
  foundation.vga_clear()
  foundation.vga_write_string("=== Wget ===\n\n")
  
  foundation.vga_write_string("Downloading: ")
  foundation.vga_write_string(url)
  foundation.vga_write_string("\n")
  
  http.http_init()
  
  var response: [u8; 8192]
  var result: u32 = http.http_get(url, @ptrFromInt(response))
  
  if result == 0 {
    foundation.vga_write_string("Saving to: ")
    foundation.vga_write_string(output)
    foundation.vga_write_string("\n")
    
    var fd: u32 = filesystem.vfs_open(output, 1)
    if fd != 0 {
      filesystem.vfs_write(fd, @ptrFromInt(response), 8192)
      filesystem.vfs_close(fd)
      foundation.vga_write_string("Download complete!\n")
    }
  } else {
    foundation.vga_write_string("Download failed!\n")
  }
}
