// home-os Grep
// Search text patterns

import "../../kernel/src/core/foundation.home" as foundation
import "../../kernel/src/core/filesystem.home" as filesystem

fn grep_search_line(line: u64, pattern: u64) -> u32 {
  // Simple substring search (stub)
  return 1
}

export fn grep_main(pattern: u64, file: u64) {
  foundation.vga_clear()
  foundation.vga_write_string("=== Grep ===\n\n")
  foundation.vga_write_string("Searching for: ")
  foundation.vga_write_string(pattern)
  foundation.vga_write_string("\n\n")
  
  var fd: u32 = filesystem.vfs_open(file, 0)
  if fd == 0 {
    foundation.vga_write_string("File not found\n")
    return
  }
  
  var buffer: [u8; 1024]
  var bytes: u64 = filesystem.vfs_read(fd, @ptrFromInt(buffer), 1024)
  
  // Search for pattern (stub)
  foundation.vga_write_string("Found matches:\n")
  foundation.vga_write_string("Line 1: example match\n")
  foundation.vga_write_string("Line 5: another match\n")
  
  filesystem.vfs_close(fd)
}
