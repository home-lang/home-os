# home-os Raspberry Pi 3 B+ Minimal Profile
# Optimized for 1GB RAM constraint
#
# Target: < 64MB kernel footprint, < 96MB total with userspace
# Boot target: < 5 seconds to shell
#
# Usage: ./scripts/build-unified.sh --target=rpi3 --profile=pi3-minimal

[profile]
name = pi3-minimal
description = Minimal image for Raspberry Pi 3 B+ (1GB RAM)
target = rpi3
arch = arm64

# ============================================================================
# MEMORY BUDGET
# ============================================================================

[memory]
# Target total footprint under 96MB for headless operation
kernel_heap_mb = 8
buffer_cache_mb = 16
page_cache_mb = 24
slab_cache_mb = 4
dma_pool_mb = 2
total_budget_mb = 64

# Process limits (reduced for 1GB)
max_processes = 64
max_threads_per_process = 16
stack_size_kb = 256
kernel_stack_kb = 8

# ============================================================================
# PROCESS LIMITS
# ============================================================================

[process]
max_processes = 64
max_files_per_process = 128
max_open_files = 512
max_pending_signals = 32

# ============================================================================
# FILESYSTEM
# ============================================================================

[filesystem]
max_inodes = 4096
max_open_files = 512
max_mounts = 16
buffer_cache_entries = 256
dentry_cache_entries = 512
read_ahead_kb = 64

# Disable heavy features
enable_xattr = false
enable_acl = false
enable_compression = false
enable_encryption = false

# ============================================================================
# NETWORKING (Minimal)
# ============================================================================

[network]
# Core protocols only
enable_tcp = true
enable_udp = true
enable_icmp = true
enable_dhcp = true
enable_dns = true

# Disable heavy protocols for minimal image
enable_tls = false
enable_https = false
enable_websocket = false
enable_http = true
enable_nfs = false
enable_smb = false
enable_mqtt = false
enable_coap = false
enable_ipv6 = false

# Reduced buffers
max_sockets = 64
socket_buffer_kb = 32
tcp_max_connections = 32
udp_max_sockets = 16

# ============================================================================
# DRIVERS
# ============================================================================

[drivers]
# Essential drivers only for Pi 3 B+

# Core
enable_serial = true
enable_gpio = true
enable_i2c = true
enable_spi = true
enable_pwm = true

# Storage
enable_sdmmc = true
enable_bcm_emmc = true
enable_nvme = false
enable_ahci = false
enable_raid = false

# Input
enable_keyboard = true
enable_mouse = true
enable_touchpad = false
enable_touchscreen = false
enable_gamepad = false

# Display (minimal)
enable_framebuffer = true
enable_fb_console = true
enable_gpu = false
enable_hdmi = true
enable_vga = false

# USB (basic)
enable_usb = true
enable_xhci = false
enable_ehci = true
enable_uhci = false
enable_usb_hub = true

# Network
enable_ethernet = true
enable_wifi = true
enable_bluetooth = true
enable_cyw43455 = true

# Audio (disabled for minimal)
enable_audio = false
enable_sound = false

# Sensors (minimal)
enable_sensors = false
enable_hwmon = true
enable_thermal = true

# Power
enable_acpi = false
enable_battery = false

# Misc (disabled)
enable_camera = false
enable_printer = false
enable_scanner = false
enable_fingerprint = false
enable_smartcard = false
enable_tpm = false
enable_nvdimm = false
enable_floppy = false
enable_cdrom = false

# ============================================================================
# SECURITY (Minimal but essential)
# ============================================================================

[security]
enable_capabilities = true
enable_seccomp = true
enable_audit = false
enable_smep = false
enable_smap = false
enable_aslr = true
enable_wx_enforcement = true

# ============================================================================
# BOOT OPTIMIZATION
# ============================================================================

[boot]
# Aggressive boot optimization for Pi 3
parallel_init = true
lazy_module_load = true
skip_memory_test = true
minimal_driver_probe = true
defer_non_essential = true
boot_profile = headless

# Target boot phases (microseconds)
target_firmware_us = 300000
target_bootloader_us = 200000
target_kernel_early_us = 500000
target_drivers_us = 1500000
target_filesystem_us = 800000
target_userspace_us = 700000
target_total_us = 5000000

# ============================================================================
# DEBUG (Minimal)
# ============================================================================

[debug]
enable_serial_console = true
enable_kernel_symbols = false
enable_stack_traces = true
enable_panic_debug = true
enable_gdb_stub = false
enable_profiler = false
enable_memleak = false
log_level = error

# ============================================================================
# GUI (Disabled)
# ============================================================================

[gui]
enable_craft = false
enable_compositor = false
enable_window_manager = false
enable_desktop = false
enable_browser = false

# ============================================================================
# APPLICATIONS
# ============================================================================

[apps]
# Minimal userspace
enable_shell = true
enable_init = true
enable_coreutils = true

# Disabled apps
enable_gui_apps = false
enable_browser = false
enable_editor = false
enable_file_manager = false
enable_terminal = false
enable_calculator = false
enable_system_monitor = false

# Minimal utilities only
utils_enabled = ls,cat,cp,mv,rm,mkdir,rmdir,echo,pwd,ps,kill,mount,umount,ifconfig,ping,dmesg,free,df,top

# ============================================================================
# KERNEL FEATURES
# ============================================================================

[kernel]
# SMP (use all 4 cores)
enable_smp = true
max_cpus = 4

# Power management
enable_cpufreq = true
enable_thermal = true
enable_pm = true

# Timers
enable_hrtimers = true
enable_tickless = true

# IPC (minimal)
enable_pipes = true
enable_fifos = true
enable_unix_sockets = true
enable_shared_memory = true
enable_message_queues = false
enable_semaphores = true

# ============================================================================
# BUILD OPTIONS
# ============================================================================

[build]
optimization = size
strip_symbols = true
compress_kernel = true
compression = lz4
debug_info = false
assertions = false
