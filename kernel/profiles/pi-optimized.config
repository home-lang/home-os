# HomeOS Kernel Profile: Pi Optimized
# Target: 24MB kernel footprint, 128MB system RAM (works on Pi 3 with 1GB)
# Use case: Raspberry Pi 3/4/5 with GUI, optimized for SD card and low RAM

# ============================================================================
# Profile Metadata
# ============================================================================
PROFILE=pi-optimized
PROFILE_DESCRIPTION="Optimized for Raspberry Pi with GUI support"
TARGET_KERNEL_MB=24
TARGET_SYSTEM_MB=128

# ============================================================================
# Core Limits (Pi-optimized)
# ============================================================================
MAX_PROCESSES=128
MAX_FILES=256
MAX_SOCKETS=64
BUFFER_CACHE_MB=8           # Smaller buffer cache for SD
SLAB_CACHE_MB=4

# ============================================================================
# Memory Management
# ============================================================================
FEATURE_MM_ZRAM=yes         # Critical for Pi
FEATURE_MM_SLAB=yes
FEATURE_MM_SWAP=yes         # ZRAM-based swap
FEATURE_MM_MEMCG=no         # Skip for simplicity
FEATURE_MM_HUGEPAGES=no     # Not useful on Pi

# ============================================================================
# Process Management
# ============================================================================
FEATURE_PROCESS_SMP=yes     # Pi 3/4/5 are multi-core
FEATURE_PROCESS_CGROUPS=no
FEATURE_PROCESS_CONTAINERS=no

# ============================================================================
# Security (Essential)
# ============================================================================
FEATURE_SEC_CAPABILITIES=yes
FEATURE_SEC_SECCOMP=yes
FEATURE_SEC_AUDIT=no        # Skip to save memory
FEATURE_SEC_SMEP_SMAP=no    # ARM uses PAN/PXN
FEATURE_SEC_ARM_PAN_PXN=yes # ARM-specific security
FEATURE_SEC_KASAN=no

# ============================================================================
# Networking (Essential)
# ============================================================================
FEATURE_NET_TCP=yes
FEATURE_NET_UDP=yes
FEATURE_NET_ICMP=yes
FEATURE_NET_DHCP=yes
FEATURE_NET_DNS=yes
FEATURE_NET_HTTP=yes
FEATURE_NET_TLS=yes
FEATURE_NET_WEBSOCKET=no
FEATURE_NET_IPV6=no         # Save memory
FEATURE_NET_MQTT=no
FEATURE_NET_NFS=no
FEATURE_NET_SMB=no

# ============================================================================
# File Systems (Pi-focused)
# ============================================================================
FEATURE_FS_VFS=yes
FEATURE_FS_FAT32=yes        # Boot partition
FEATURE_FS_EXT2=yes         # Root partition
FEATURE_FS_TMPFS=yes
FEATURE_FS_PROCFS=yes
FEATURE_FS_SYSFS=yes
FEATURE_FS_DEVFS=yes
FEATURE_FS_BTRFS=no
FEATURE_FS_NTFS=no
FEATURE_FS_ISO9660=no

# ============================================================================
# Hardware Drivers (Pi-specific)
# ============================================================================
FEATURE_DRV_ATA=no
FEATURE_DRV_AHCI=no
FEATURE_DRV_NVME=yes        # Pi 5 has NVMe
FEATURE_DRV_SDMMC=yes       # Essential for Pi
FEATURE_DRV_BCM_EMMC=yes    # Pi-specific eMMC
FEATURE_DRV_RAID=no
FEATURE_DRV_CDROM=no
FEATURE_DRV_FLOPPY=no

FEATURE_DRV_KEYBOARD=yes
FEATURE_DRV_MOUSE=yes
FEATURE_DRV_TOUCHPAD=no
FEATURE_DRV_TOUCHSCREEN=yes # Pi touchscreens
FEATURE_DRV_GAMEPAD=no

FEATURE_DRV_E1000=no
FEATURE_DRV_RTL8139=no
FEATURE_DRV_VIRTIO_NET=no
FEATURE_DRV_WIFI=yes        # CYW43455 on Pi
FEATURE_DRV_BLUETOOTH=yes   # Pi has BT
FEATURE_DRV_CYW43455=yes    # Pi WiFi/BT chip

FEATURE_DRV_USB_UHCI=no
FEATURE_DRV_USB_EHCI=yes
FEATURE_DRV_USB_XHCI=yes    # Pi 4/5
FEATURE_DRV_USB_HUB=yes

FEATURE_DRV_VGA=no
FEATURE_DRV_FRAMEBUFFER=yes # Essential for GUI
FEATURE_DRV_GPU=yes         # VideoCore

FEATURE_DRV_PCI=no          # Pi 3/4 don't have PCI
FEATURE_DRV_PCIE=yes        # Pi 5 has PCIe
FEATURE_DRV_ACPI=no         # No ACPI on ARM
FEATURE_DRV_RTC=yes
FEATURE_DRV_TIMER=yes
FEATURE_DRV_SERIAL=yes

FEATURE_DRV_GPIO=yes        # Essential for Pi
FEATURE_DRV_I2C=yes
FEATURE_DRV_SPI=yes
FEATURE_DRV_PWM=yes
FEATURE_DRV_AUDIO=yes       # HDMI/3.5mm audio
FEATURE_DRV_CAMERA=yes      # Pi camera

FEATURE_DRV_BATTERY=no
FEATURE_DRV_TPM=no
FEATURE_DRV_SENSORS=yes

# ============================================================================
# GUI (Optimized for Pi)
# ============================================================================
FEATURE_GUI_CRAFT=yes
FEATURE_GUI_COMPOSITOR=yes
FEATURE_GUI_VULKAN=no       # Use OpenGL on Pi
FEATURE_GUI_OPENGL=yes

# GUI Resolution limits for memory
GUI_MAX_WIDTH=1920
GUI_MAX_HEIGHT=1080
GUI_DEFAULT_WIDTH=1280
GUI_DEFAULT_HEIGHT=720
GUI_COLOR_DEPTH=16          # Use 16-bit for less memory

# ============================================================================
# Performance & Debug (Minimal debug for production)
# ============================================================================
FEATURE_PERF_BOOT_OPT=yes
FEATURE_PERF_PROFILER=no
FEATURE_PERF_ASYNC_IO=yes

FEATURE_DEBUG_GDB=no
FEATURE_DEBUG_PANIC=yes
FEATURE_DEBUG_MEMLEAK=no

# ============================================================================
# Pi-Specific Optimizations
# ============================================================================

# SD Card optimizations
SD_READAHEAD_KB=64          # Smaller read-ahead for SD
SD_WRITE_CACHE=no           # Safer for SD wear
SD_IO_SCHEDULER=noop        # Simple scheduler for flash

# Memory pressure handling
OOM_KILL_AGGRESSIVE=yes     # Kill quickly when low on RAM
SWAP_PRESSURE_RATIO=60      # Start swapping earlier

# Power management
CPU_DEFAULT_GOVERNOR=ondemand
THERMAL_THROTTLE_TEMP=80    # Throttle at 80°C
THERMAL_SHUTDOWN_TEMP=85    # Shutdown at 85°C

# ============================================================================
# Optimization
# ============================================================================
OPTIMIZE=ReleaseSmall       # Optimize for size
STRIP_DEBUG=yes
LTO=yes                     # Enable LTO for smaller binary
